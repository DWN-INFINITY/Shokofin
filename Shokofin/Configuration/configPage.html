<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Shoko</title>
</head>
<body>
    <div data-role="page" class="page type-interior pluginConfigurationPage shokoConfigPage" data-require="emby-input,emby-button,emby-select,emby-checkbox">
        <div data-role="content">
            <div class="content-primary">
                <form class="shokoConfigForm">
                    <div class="verticalSection verticalSection-extrabottompadding">
                        <div class="sectionTitleContainer flex align-items-center">
                            <h2 class="sectionTitle">Shoko</h2>
                            <a is="emby-linkbutton" rel="noopener noreferrer" class="raised button-alt headerHelpButton emby-button" target="_blank" href="https://docs.shokoanime.com/shokofin/configuration/">Help</a>
                        </div>
                        <h3>Connection Settings</h3>
                        <div class="inputContainer">
                            <input is="emby-input" type="text" id="Host" required label="Host" />
                            <div class="fieldDescription">This is the URL leading to where Shoko is running.</div>
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="text" id="Username" required label="Username" />
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="text" id="Password" label="Password" />
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="text" id="ApiKey" label="API Key" />
                            <div class="fieldDescription">This field is auto-generated using the credentials. Only set this manually if that doesn't work!</div>
                        </div>
                        <h3>Library Settings</h3>
                        <h4>Shared</h4>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="UpdateWatchedStatus" />
                            <span>Sync-back watched status on Shoko (Scrobble)</span>
                        </label>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="FilterOnLibraryTypes" />
                            <span>Filter out files for 'Shows' and 'Movie' library-types</span>
                        </label>
                        <h4>Series</h4>
                        <div class="selectContainer">
                            <label class="selectLabel" for="SeriesGrouping">Series/Season Grouping</label>
                            <select is="emby-select" id="SeriesGrouping" name="SeriesGrouping" class="emby-select-withcolor emby-select">
                                <option value="Default" selected>Do not group series into seasons</option>
                                <option value="MergeFriendly">Group series into seasons using the TvDB/TMDB data stored in Shoko</option>
                                <option value="ShokoGroup">Group series into seasons based on Shoko's groups</option>
                            </select>
                            <div class="fieldDescription">Determines how to group Series together and divide them into Seasons.</div>
                            <div class="fieldDescription"><strong>Warning:</strong> Series merging must be enabled in the <strong>library settings</strong> when using this option.</div>
                        </div>
                        <div id="SeasonOrderingItem" class="selectContainer">
                            <label class="selectLabel" for="SeasonOrdering">Shoko Group's Season Order</label>
                            <select is="emby-select" id="SeasonOrdering" name="SeasonOrdering" class="emby-select-withcolor emby-select">
                                <option value="Default">Let Shoko decide the order</option>
                                <option value="ReleaseDate">Order seasons by their release date</option>
                                <!--<option value="Chronological">Chronological order</option>-->
                            </select>
                            <div class="fieldDescription">Determines the Season order within each Series.</div>
                        </div>
                        <h4>Specials</h4>
                        <label id="MarkSpecialsWhenGroupedItem" class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="MarkSpecialsWhenGrouped" />
                            <span>Add a number to the title of each Specials</span>
                        </label>
                        <div class="selectContainer">
                            <label class="selectLabel" for="SpecialsPlacement">Specials placement</label>
                            <select is="emby-select" id="SpecialsPlacement" name="SpecialsPlacement" class="emby-select-withcolor emby-select">
                                <option value="Default">Use default placement for Series Grouping</option>
                                <option value="Excluded">Don't place specials within seasons</option>
                                <option value="AfterSeason">Always place specials after the normal episodes</option>
                                <option value="InBetweenSeasonByAirDate">Use release date to place specials</option>
                                <option value="InBetweenSeasonByOtherData">Use the TvDB/TMDB data (if available) to place specials</option>
                                <option value="InBetweenSeasonMixed">Use either the TvDB/TMDB data or release date if the data is not available to place specials</option>
                            </select>
                            <div class="fieldDescription">Determines how to place Specials within Seasons</div>
                            <div class="fieldDescription"><strong>Warning:</strong> Modifying this setting requires a rebuild (and not just a full-refresh) of any libraries using this plugin, or else you will have mixed metadata.</div>
                        </div>
                        <h4>Movies</h4>
                        <div class="selectContainer">
                            <label class="selectLabel" for="BoxSetGrouping">Box-Set Creation</label>
                            <select is="emby-select" id="BoxSetGrouping" name="BoxSetGrouping" class="emby-select-withcolor emby-select">
                                <option value="Default" selected>Do not create Bos-Sets for Movies</option>
                                <option value="ShokoSeries">Create Box-Sets based upon Shoko's Series entries</option>
                                <option value="ShokoGroup">Create Box-Sets based upon Shoko's Groups and Series entries</option>
                            </select>
                            <div class="fieldDescription">Determines how to group Movies together into Box-Sets.</div>
                        </div>
                        <div id="MovieOrderingItem" class="selectContainer">
                            <label class="selectLabel" for="MovieOrdering">Box-Set Movie Order</label>
                            <select is="emby-select" id="MovieOrdering" name="MovieOrdering" class="emby-select-withcolor emby-select">
                                <option value="Default">Let Shoko decide the order</option>
                                <option value="ReleaseDate">Order Movies by their release date</option>
                                <!--<option value="Chronological">Chronological order</option>-->
                            </select>
                            <div class="fieldDescription">Determines the Movie order within each Box-Set</div>
                        </div>
                        <h3>Title Settings</h3>
                        <div class="selectContainer selectContainer-withDescription">
                            <label class="selectLabel" for="TitleMainType">Main Title</label>
                            <select is="emby-select" id="TitleMainType" name="TitleMainType" class="emby-select-withcolor emby-select">
                                <option value="Default">Let Shoko decide</option>
                                <option value="MetadataPreferred">Preferred metadata language</option>
                                <option value="Origin">Language in country of origin</option>
                            </select>
                            <div class="fieldDescription">Titles will fallback to Default if not found for the target language.</div>
                        </div>
                        <div class="selectContainer selectContainer-withDescription">
                            <label class="selectLabel" for="TitleAlternateType">Alternate Title</label>
                            <select is="emby-select" id="TitleAlternateType" name="TitleAlternateType" class="emby-select-withcolor emby-select">
                                <option value="Default">Let Shoko decide</option>
                                <option value="MetadataPreferred">Preferred metadata language</option>
                                <option value="Origin">Language in country of origin</option>
                                <option value="Ignore">Do not use alternate titles</option>
                            </select>
                            <div class="fieldDescription">Titles will fallback to Default if not found for the target language.</div>
                        </div>
                        <h3>Synopsis Settings</h3>
                        <div class="selectContainer">
                            <label class="selectLabel" for="DescriptionSource">Synopsis source</label>
                            <select is="emby-select" id="DescriptionSource" name="DescriptionSource" class="emby-select-withcolor emby-select">
                                <option value="Default">Use default source for Series Grouping</option>
                                <option value="OnlyAniDb">Only use AniDB</option>
                                <option value="PreferAniDb">Prefer AniDB if available, otherwise use TvDB/TMDB</option>
                                <option value="OnlyOther">Only use TvDB/TMDB</option>
                                <option value="PreferOther">Prefer TvDB/TMDB if available, otherwise use AniDB</option>
                            </select>
                        </div>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="SynopsisCleanLinks" />
                            <span>Remove links</span>
                        </label>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="SynopsisCleanMiscLines" />
                            <span>Remove the line if it starts with ('* ' / '-- ' / '~ ')</span>
                        </label>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="SynopsisRemoveSummary" />
                            <span>Remove anything after Source, Note or Summary</span>
                        </label>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="SynopsisCleanMultiEmptyLines" />
                            <span>Collapse excessive empty lines</span>
                        </label>
                        <h3>Provider Settings</h3>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="PreferAniDbPoster" />
                            <span>Prefer poster image from AniDb for Series/Seasons</span>
                        </label>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="AddAniDBId" />
                            <span>Add AniDB Id to all entries</span>
                        </label>
                        <h3>Tag Settings</h3>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="HideArtStyleTags" />
                            <span>Hide art style related tags</span>
                        </label>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="HideSourceTags" />
                            <span>Hide source related tags</span>
                        </label>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="HideMiscTags" />
                            <span>Hide misc info tags that may be useful</span>
                        </label>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="HidePlotTags" />
                            <span>Hide potentially plot-spoiling tags</span>
                        </label>
                        <label class="checkboxContainer">
                            <input is="emby-checkbox" type="checkbox" id="HideAniDbTags" />
                            <span>Hide any miscellaneous tags</span>
                        </label>
                        <div>
                            <button is="emby-button" type="submit" class="raised button-submit block emby-button">
                                <span>Save</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <script type="text/javascript">
            var PluginConfig = {
                pluginId: "5216ccbf-d24a-4eb3-8a7e-7da4230b7052"
            };

            document.querySelector('.shokoConfigPage')
                .addEventListener('pageshow', function () {
                    Dashboard.showLoadingMsg();
                    ApiClient.getPluginConfiguration(PluginConfig.pluginId).then(function (config) {
                        document.querySelector('#Host').value = config.Host;
                        document.querySelector('#Username').value = config.Username;
                        document.querySelector('#Password').value = config.Password;
                        document.querySelector('#ApiKey').value = config.ApiKey;
                        document.querySelector('#UpdateWatchedStatus').checked = config.UpdateWatchedStatus;
                        document.querySelector('#HideArtStyleTags').checked = config.HideArtStyleTags;
                        document.querySelector('#HideSourceTags').checked = config.HideSourceTags;
                        document.querySelector('#HideMiscTags').checked = config.HideMiscTags;
                        document.querySelector('#HidePlotTags').checked = config.HidePlotTags;
                        document.querySelector('#HideAniDbTags').checked = config.HideAniDbTags;
                        document.querySelector('#SynopsisCleanLinks').checked = config.SynopsisCleanLinks;
                        document.querySelector('#SynopsisCleanMiscLines').checked = config.SynopsisCleanMiscLines;
                        document.querySelector('#SynopsisRemoveSummary').checked = config.SynopsisRemoveSummary;
                        document.querySelector('#SynopsisCleanMultiEmptyLines').checked = config.SynopsisCleanMultiEmptyLines;
                        document.querySelector('#TitleMainType').value = config.TitleMainType;
                        document.querySelector('#TitleAlternateType').value = config.TitleAlternateType;
                        document.querySelector('#DescriptionSource').value = config.DescriptionSource;
                        document.querySelector('#SeriesGrouping').value = config.SeriesGrouping;
                        document.querySelector('#SeasonOrdering').value = config.SeasonOrdering;
                        document.querySelector('#SpecialsPlacement').value = config.SpecialsPlacement;
                        document.querySelector('#BoxSetGrouping').value = config.BoxSetGrouping;
                        document.querySelector('#MovieOrdering').value = config.MovieOrdering;
                        document.querySelector('#MarkSpecialsWhenGrouped').checked = config.MarkSpecialsWhenGrouped;
                        document.querySelector('#FilterOnLibraryTypes').checked = config.FilterOnLibraryTypes;
                        document.querySelector('#AddAniDBId').checked = config.AddAniDBId;
                        document.querySelector('#PreferAniDbPoster').checked = config.PreferAniDbPoster;
                        if (config.SeriesGrouping === "ShokoGroup") {
                            document.querySelector('#SeasonOrderingItem').removeAttribute("hidden");
                            document.querySelector('#MarkSpecialsWhenGroupedItem').removeAttribute("hidden");
                        }
                        else {
                            document.querySelector('#SeasonOrderingItem').setAttribute("hidden", "");
                            document.querySelector('#MarkSpecialsWhenGroupedItem').setAttribute("hidden", "");
                        }
                        if (config.BoxSetGrouping === "ShokoGroup") {
                            document.querySelector('#MovieOrderingItem').removeAttribute("hidden");
                        }
                        else {
                            document.querySelector('#MovieOrderingItem').setAttribute("hidden", "");
                        }
                        Dashboard.hideLoadingMsg();
                    });
                });
            document.querySelector('#SeriesGrouping')
                .addEventListener('input', function () {
                    if (document.querySelector('#SeriesGrouping').value === "ShokoGroup") {
                        document.querySelector('#SeasonOrderingItem').removeAttribute("hidden");
                        document.querySelector('#MarkSpecialsWhenGroupedItem').removeAttribute("hidden");
                    }
                    else {
                        document.querySelector('#SeasonOrderingItem').setAttribute("hidden", "");
                        document.querySelector('#MarkSpecialsWhenGroupedItem').setAttribute("hidden", "");
                    }
                });
            document.querySelector('#BoxSetGrouping')
                .addEventListener('input', function () {
                    if (document.querySelector('#BoxSetGrouping').value === "ShokoGroup") {
                        document.querySelector('#MovieOrderingItem').removeAttribute("hidden");
                    }
                    else {
                        document.querySelector('#MovieOrderingItem').setAttribute("hidden", "");
                    }
                });

            document.querySelector('.shokoConfigForm')
                .addEventListener('submit', function (e) {
                    Dashboard.showLoadingMsg();

                    ApiClient.getPluginConfiguration(PluginConfig.pluginId).then(function (config) {
                        config.Host = document.querySelector('#Host').value;
                        config.Username = document.querySelector('#Username').value;
                        config.Password = document.querySelector('#Password').value;
                        config.ApiKey = document.querySelector('#ApiKey').value;
                        config.UpdateWatchedStatus = document.querySelector('#UpdateWatchedStatus').checked;
                        config.HideArtStyleTags = document.querySelector('#HideArtStyleTags').checked;
                        config.HideSourceTags = document.querySelector('#HideSourceTags').checked;
                        config.HideMiscTags = document.querySelector('#HideMiscTags').checked;
                        config.HidePlotTags = document.querySelector('#HidePlotTags').checked;
                        config.HideAniDbTags = document.querySelector('#HideAniDbTags').checked;
                        config.SynopsisCleanLinks = document.querySelector('#SynopsisCleanLinks').checked;
                        config.SynopsisCleanMiscLines = document.querySelector('#SynopsisCleanMiscLines').checked;
                        config.SynopsisRemoveSummary = document.querySelector('#SynopsisRemoveSummary').checked;
                        config.SynopsisCleanMultiEmptyLines = document.querySelector('#SynopsisCleanMultiEmptyLines').checked;
                        config.TitleMainType = document.querySelector('#TitleMainType').value;
                        config.TitleAlternateType = document.querySelector('#TitleAlternateType').value;
                        config.DescriptionSource = document.querySelector('#DescriptionSource').value;
                        config.SeriesGrouping = document.querySelector('#SeriesGrouping').value;
                        config.SeasonOrdering = document.querySelector('#SeasonOrdering').value;
                        config.SpecialsPlacement = document.querySelector('#SpecialsPlacement').value;
                        config.BoxSetGrouping = document.querySelector('#BoxSetGrouping').value;
                        config.MovieOrdering = document.querySelector('#MovieOrdering').value;
                        config.MarkSpecialsWhenGrouped = document.querySelector('#MarkSpecialsWhenGrouped').checked;
                        config.DisplaySpecialsInSeason = document.querySelector('#DisplaySpecialsInSeason').checked;
                        config.FilterOnLibraryTypes = document.querySelector('#FilterOnLibraryTypes').checked;
                        config.AddAniDBId = document.querySelector('#AddAniDBId').checked;
                        config.PreferAniDbPoster = document.querySelector('#PreferAniDbPoster').checked;
                        ApiClient.updatePluginConfiguration(PluginConfig.pluginId, config).then(Dashboard.processPluginConfigurationUpdateResult);
                    });
                    e.preventDefault();
                    return false;
                });
        </script>
    </div>
</body>
</html>
